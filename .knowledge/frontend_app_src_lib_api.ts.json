{"is_source_file": true, "format": "TypeScript", "description": "This file provides API utility functions for the Recipe Explorer app, including fetching recipe data from a remote API or using local mock data as fallback. It includes functions for querying recipes with filters, fetching recipes by ID, handling environment configs, and performing safe fetch operations with robust error handling.", "external_files": ["./types"], "external_methods": ["fetch"], "published": ["getRecipes", "getRecipeById"], "classes": [], "methods": [{"name": "function toQueryString(params: Record<string, unknown> = {}): string { toQueryString", "description": "Converts an object of parameters into a URL query string, skipping undefined or null values and trimming strings.", "scope": "", "scopeKind": ""}, {"name": "async function safeFetchJson<T>(url: string, init?: RequestInit): Promise<ApiResult<T>> { safeFetchJson", "description": "Performs a fetch request with error normalization, caching policies based on environment, and JSON parsing with error handling.", "scope": "", "scopeKind": ""}, {"name": "function queryMockRecipes(params: RecipeQueryParams = {}): PaginatedResult<Recipe> { queryMockRecipes", "description": "Filters, sorts, and paginates the mock dataset of recipes based on query parameters, simulating backend behavior.", "scope": "", "scopeKind": ""}, {"name": "function buildUrl(path: string, params?: Record<string, unknown>): string | null { buildUrl", "description": "Constructs a full URL for API requests based on a base URL, path, and optional query parameters.", "scope": "", "scopeKind": ""}, {"name": "export async function getRecipes( getRecipes", "description": "Fetches a paginated list of recipes matching query parameters, attempting remote fetch first, falling back to mock data.", "scope": "", "scopeKind": ""}, {"name": "export async function getRecipeById( getRecipeById", "description": "Fetches a specific recipe by ID, attempting remote fetch first, with fallback to mock data.", "scope": "", "scopeKind": ""}], "calls": ["fetch", "toQueryString", "safeFetchJson", "buildUrl", "queryMockRecipes"], "search-terms": ["API utilities", "recipe fetch", "mock dataset", "RecipeExplorer", "fallback", "fetch with cache control", "environment variables"], "state": 2, "file_id": 9, "knowledge_revision": 22, "git_revision": "", "revision_history": [{"19": ""}, {"21": ""}, {"22": ""}], "ctags": [{"_type": "tag", "name": "Date", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^        const ad = a.datePublished ? Date.parse(a.datePublished) : 0;$/", "language": "TypeScript", "kind": "constant", "scope": "queryMockRecipes", "scopeKind": "function"}, {"_type": "tag", "name": "Date", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^        const bd = b.datePublished ? Date.parse(b.datePublished) : 0;$/", "language": "TypeScript", "kind": "constant", "scope": "queryMockRecipes", "scopeKind": "function"}, {"_type": "tag", "name": "ENV", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^const ENV = import.meta.env || {};$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "IS_DEV", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^const IS_DEV = !!(ENV?.PUBLIC_NODE_ENV$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "MOCK_RECIPES", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^const MOCK_RECIPES: Recipe[] = [$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "PUBLIC_API_BASE", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^const PUBLIC_API_BASE: string | undefined = ENV.PUBLIC_API_BASE || ENV.PUBLIC_BACKEND_URL;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "ad", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^        const ad = a.datePublished ? Date.parse(a.datePublished) : 0;$/", "language": "TypeScript", "kind": "constant", "scope": "queryMockRecipes", "scopeKind": "function"}, {"_type": "tag", "name": "base", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^  const base = (PUBLIC_API_BASE || '').trim();$/", "language": "TypeScript", "kind": "constant", "scope": "buildUrl", "scopeKind": "function"}, {"_type": "tag", "name": "bd", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^        const bd = b.datePublished ? Date.parse(b.datePublished) : 0;$/", "language": "TypeScript", "kind": "constant", "scope": "queryMockRecipes", "scopeKind": "function"}, {"_type": "tag", "name": "body", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^          const body = await res.json();$/", "language": "TypeScript", "kind": "constant", "scope": "safeFetchJson", "scopeKind": "function"}, {"_type": "tag", "name": "buildUrl", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^function buildUrl(path: string, params?: Record<string, unknown>): string | null {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "contentType", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^    const contentType = res.headers.get('content-type') || '';$/", "language": "TypeScript", "kind": "constant", "scope": "safeFetchJson", "scopeKind": "function"}, {"_type": "tag", "name": "course", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^    course,$/", "language": "TypeScript", "kind": "constant", "scope": "queryMockRecipes", "scopeKind": "function"}, {"_type": "tag", "name": "cuisine", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^    cuisine,$/", "language": "TypeScript", "kind": "constant", "scope": "queryMockRecipes", "scopeKind": "function"}, {"_type": "tag", "name": "data", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^      const data = await res.json();$/", "language": "TypeScript", "kind": "constant", "scope": "safeFetchJson", "scopeKind": "function"}, {"_type": "tag", "name": "data", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^  const data = queryMockRecipes(params);$/", "language": "TypeScript", "kind": "constant", "scope": "getRecipes", "scopeKind": "function"}, {"_type": "tag", "name": "difficulty", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^    difficulty,$/", "language": "TypeScript", "kind": "constant", "scope": "queryMockRecipes", "scopeKind": "function"}, {"_type": "tag", "name": "dir", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^    const dir = sortDir === 'desc' ? -1 : 1;$/", "language": "TypeScript", "kind": "constant", "scope": "queryMockRecipes", "scopeKind": "function"}, {"_type": "tag", "name": "err", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^    const err = e as unknown as { message?: string };$/", "language": "TypeScript", "kind": "constant", "scope": "safeFetchJson", "scopeKind": "function"}, {"_type": "tag", "name": "found", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^  const found = MOCK_RECIPES.find((r) => r.id === id);$/", "language": "TypeScript", "kind": "constant", "scope": "getRecipeById", "scopeKind": "function"}, {"_type": "tag", "name": "getRecipeById", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^export async function getRecipeById($/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "getRecipes", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^export async function getRecipes($/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "hasMore", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^  const hasMore = start + pageSize < total;$/", "language": "TypeScript", "kind": "constant", "scope": "queryMockRecipes", "scopeKind": "function"}, {"_type": "tag", "name": "hay", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^      const hay = `${r.title} ${r.description ?? ''} ${r.ingredients.map(i => i.text).join(' ')}/", "language": "TypeScript", "kind": "constant", "scope": "queryMockRecipes", "scopeKind": "function"}, {"_type": "tag", "name": "isJson", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^    const isJson = contentType.includes('application\\/json');$/", "language": "TypeScript", "kind": "constant", "scope": "safeFetchJson", "scopeKind": "function"}, {"_type": "tag", "name": "message", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^    const message = err?.message || 'Network error';$/", "language": "TypeScript", "kind": "constant", "scope": "safeFetchJson", "scopeKind": "function"}, {"_type": "tag", "name": "minRating", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^    minRating,$/", "language": "TypeScript", "kind": "constant", "scope": "queryMockRecipes", "scopeKind": "function"}, {"_type": "tag", "name": "needle", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^    const needle = q.trim().toLowerCase();$/", "language": "TypeScript", "kind": "constant", "scope": "queryMockRecipes", "scopeKind": "function"}, {"_type": "tag", "name": "normalized", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^    const normalized = base.endsWith('\\/') ? base.slice(0, -1) : base;$/", "language": "TypeScript", "kind": "constant", "scope": "buildUrl", "scopeKind": "function"}, {"_type": "tag", "name": "p", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^    const p = path.startsWith('\\/') ? path : `\\/${path}`;$/", "language": "TypeScript", "kind": "constant", "scope": "buildUrl", "scopeKind": "function"}, {"_type": "tag", "name": "page", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^    page = 1,$/", "language": "TypeScript", "kind": "constant", "scope": "queryMockRecipes", "scopeKind": "function"}, {"_type": "tag", "name": "paged", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^  const paged = items.slice(start, start + pageSize);$/", "language": "TypeScript", "kind": "constant", "scope": "queryMockRecipes", "scopeKind": "function"}, {"_type": "tag", "name": "q", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^    q,$/", "language": "TypeScript", "kind": "constant", "scope": "queryMockRecipes", "scopeKind": "function"}, {"_type": "tag", "name": "qs", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^  const qs = usp.toString();$/", "language": "TypeScript", "kind": "constant", "scope": "toQueryString", "scopeKind": "function"}, {"_type": "tag", "name": "queryMockRecipes", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^function queryMockRecipes(params: RecipeQueryParams = {}): PaginatedResult<Recipe> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "res", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^    const res = await fetch(url, {$/", "language": "TypeScript", "kind": "constant", "scope": "safeFetchJson", "scopeKind": "function"}, {"_type": "tag", "name": "result", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^    const result = await safeFetchJson<PaginatedResult<Recipe>>(url);$/", "language": "TypeScript", "kind": "constant", "scope": "getRecipes", "scopeKind": "function"}, {"_type": "tag", "name": "result", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^    const result = await safeFetchJson<Recipe>(url);$/", "language": "TypeScript", "kind": "constant", "scope": "getRecipeById", "scopeKind": "function"}, {"_type": "tag", "name": "safeFetchJson", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^async function safeFetchJson<T>(url: string, init?: RequestInit): Promise<ApiResult<T>> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "start", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^  const start = Math.max(0, (page - 1) * pageSize);$/", "language": "TypeScript", "kind": "constant", "scope": "queryMockRecipes", "scopeKind": "function"}, {"_type": "tag", "name": "tag", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^    tag,$/", "language": "TypeScript", "kind": "constant", "scope": "queryMockRecipes", "scopeKind": "function"}, {"_type": "tag", "name": "text", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^          const text = await res.text();$/", "language": "TypeScript", "kind": "constant", "scope": "safeFetchJson", "scopeKind": "function"}, {"_type": "tag", "name": "toQueryString", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^function toQueryString(params: Record<string, unknown> = {}): string {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "total", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^  const total = items.length;$/", "language": "TypeScript", "kind": "constant", "scope": "queryMockRecipes", "scopeKind": "function"}, {"_type": "tag", "name": "url", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^  const url = buildUrl('\\/recipes', params);$/", "language": "TypeScript", "kind": "constant", "scope": "getRecipes", "scopeKind": "function"}, {"_type": "tag", "name": "url", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^  const url = buildUrl(`\\/recipes\\/${encodeURIComponent(id)}`);$/", "language": "TypeScript", "kind": "constant", "scope": "getRecipeById", "scopeKind": "function"}, {"_type": "tag", "name": "usp", "path": "/home/kavia/workspace/code-generation/recipe-explorer-209095-209117/frontend_app/src/lib/api.ts", "pattern": "/^  const usp = new URLSearchParams();$/", "language": "TypeScript", "kind": "constant", "scope": "toQueryString", "scopeKind": "function"}], "hash": "82e9515d4198d8dcb0dacf9e5705811f", "format-version": 4, "code-base-name": "frontend_app", "filename": "frontend_app/src/lib/api.ts"}